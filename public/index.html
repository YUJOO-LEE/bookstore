<!DOCTYPE html>
<html lang='ko'>

<head>
  <meta charset='utf-8' />
  <link rel='icon' href='%PUBLIC_URL%/favicon.ico' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>Yujoo</title>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id='root'></div>
  <div class='defaults'></div>
  <div class='mask'>
    <div class='loading'></div>
  </div>
  <style>
    .defaults{
      position: absolute;
      top: -99999999px;
    }
    .mask{
      width: 100%;
      height: 100vh;
      background-color: #fff;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 100;
      opacity: 1;
      transition: opacity 2s;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .mask.off{
      opacity: 0;
    }
  </style>
  <script>
    const defaults = document.querySelector('.defaults');
    const mask = document.querySelector('.mask');
    let tags = '';
    const baseUrl = '%PUBLIC_URL%/img/';
    const imgs = [
      baseUrl+'review.jpg',
    ]
    const vids= [
      baseUrl+'library.mp4',
    ]

    createDOM();
    endLoading();

    function createDOM() {
      imgs.forEach(src=>tags+=`<img src=${src} />`);
      vids.forEach(src=>tags+=`<video src=${src}></video>`);
      defaults.innerHTML = tags;
    }

    function loadImg() {
      return new Promise((res,rej)=>{
        let countImg = 0;
        const imgDOM = defaults.querySelectorAll('img');

        imgDOM.forEach(img=>{
          img.onload = ()=>{
            // 로드 완료 후 변수 하나씩 증가
            countImg++;
            // 완료된 갯수가 배열 값의 갯수와 같다면 정상값 반환
            if (countImg === imgs.length) res(true);
          }
        })
      })
    }
    function loadVid() {
      return new Promise((res,rej)=>{
        let countVid = 0;
        const vidDOM = defaults.querySelectorAll('video');

        vidDOM.forEach(vid=>{
          vid.onloadeddata = ()=>{
            countVid++;
            if (countVid === vids.length) res(true);
          }
        })
      })
    }
    
    async function endLoading() {
      const result = await Promise.all([loadImg(), loadVid()])
      // 배열 내 모든 Promise가 완료되면 각각의 값을 result로 받음 
      const [loadedImg, loadedVid] = result;
      // result의 결과값들이 배열에 담겨있으므로 편리하게 사용하기 위해 변수로 재할당 

      if (loadedImg && loadedVid) {
        // 둘 다 true 상태라면 로딩 화면을 안보이도록 처리
        mask.classList.add('off');
      }

      setTimeout(()=>{
        // 로딩화면 투명효과 적용이후, 생성했던 DOM 요소들을 제거
        mask.remove();
        defaults.remove();
      }, 2000); // 로딩화면 transition이 1s이므로 해당시간보다 길게 지정
    }
  </script>
</body>

</html>